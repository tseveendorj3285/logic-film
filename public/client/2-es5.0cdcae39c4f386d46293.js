!function(){function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,a){if(!t)return;if("string"==typeof t)return e(t,a);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,a)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}function a(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{WMcg:function(e,a,o){"use strict";o.r(a),o.d(a,"CrupdatePersonModule",(function(){return ut}));var i,c=o("ofXK"),p=o("tyNb"),l=o("mrSG"),s=o("AcyG"),u=function(){var t=function t(e){n(this,t),this.id=e};return t.type="[CrupdatePerson] Load Person",t}(),b=function(){var t=function t(e){n(this,t),this.id=e};return t.type="[CrupdatePerson] Detach Credit",t}(),d=function(){var t=function t(e){n(this,t),this.payload=e};return t.type="[CrupdatePerson] Create Person",t}(),m=function(){var t=function t(e){n(this,t),this.payload=e};return t.type="[CrupdatePerson] Update Person",t}(),f=function(){var t=function t(){n(this,t)};return t.type="[CrupdatePerson] Reset State",t}(),h=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var a in n(this,t),e)this[a]=e[a]},g=o("vkgz"),y=o("nYR2"),v=o("fXoL"),S=o("ZQmV"),x=o("7tLl"),X=((i=function(){function e(t,a){n(this,e),this.people=t,this.titles=a}return r(e,[{key:"loadPerson",value:function(t,e){var a=this;return t.patchState({loading:!0}),this.people.get(e.id).pipe(Object(g.a)((function(e){t.patchState({person:e.person,credits:a.flattenCredits(e.credits),loading:!1})})))}},{key:"createPerson",value:function(t,e){return t.patchState({loading:!0}),this.people.create(e.payload).pipe(Object(y.a)((function(){return t.patchState({loading:!1})})),Object(g.a)((function(e){return t.patchState({person:e.person})})))}},{key:"updatePerson",value:function(t,e){return t.patchState({loading:!0}),this.people.update(t.getState().person.id,e.payload).pipe(Object(y.a)((function(){return t.patchState({loading:!1})})),Object(g.a)((function(e){return t.patchState({person:e.person})})))}},{key:"removeCredit",value:function(t,e){return t.patchState({loading:!0}),this.titles.removeCredit(e.id).pipe(Object(g.a)((function(){var a=t.getState().credits.filter((function(t){return t.pivot.id!==e.id}));t.patchState({credits:a})})),Object(y.a)((function(){return t.patchState({loading:!1})})))}},{key:"resetState",value:function(t){t.patchState({person:new h,credits:[],loading:!1})}},{key:"flattenCredits",value:function(e){var a=[];return Object.keys(e).forEach((function(r){a.push.apply(a,t(e[r]))})),a}}],[{key:"person",value:function(t){return t.person}},{key:"loading",value:function(t){return t.loading}},{key:"credits",value:function(t){return t.credits}}]),e}()).\u0275fac=function(t){return new(t||i)(v.bc(S.a),v.bc(x.a))},i.\u0275prov=v.Nb({token:i,factory:i.\u0275fac}),Object(l.b)([Object(s.a)(u)],i.prototype,"loadPerson",null),Object(l.b)([Object(s.a)(d)],i.prototype,"createPerson",null),Object(l.b)([Object(s.a)(m)],i.prototype,"updatePerson",null),Object(l.b)([Object(s.a)(b)],i.prototype,"removeCredit",null),Object(l.b)([Object(s.a)(f)],i.prototype,"resetState",null),Object(l.b)([Object(s.e)()],i,"person",null),Object(l.b)([Object(s.e)()],i,"loading",null),Object(l.b)([Object(s.e)()],i,"credits",null),i=Object(l.b)([Object(s.f)({name:"crupdatePerson",defaults:{person:new h,credits:[],loading:!1}})],i)),W=o("2Vo4"),w=o("+0xr"),C=o("r2Ys"),j=o("h586"),O=o("Lm4C"),k=o("QeDF"),E=o("i2dy"),M=o("3Pt+"),P=o("wZkO"),D=o("l9qf"),_=o("bTqV"),N=o("Rd8u"),R=o("Qu3c"),q=o("NFeN"),V=o("ihCf"),F=o("Dh3D"),A=o("FBzJ"),K=o("CH4Q"),U=o("zW5C");function I(t,e){1&t&&(v.Xb(0,"mat-header-cell",52),v.Mc(1,"Credit"),v.Wb())}function $(t,e){if(1&t&&(v.Xb(0,"mat-cell"),v.Sb(1,"media-image",53),v.Xb(2,"span"),v.Mc(3),v.Wb(),v.Wb()),2&t){var a=e.$implicit;v.Eb(1),v.qc("src",a.poster),v.Eb(2),v.Nc(a.name)}}function z(t,e){1&t&&(v.Xb(0,"mat-header-cell",52),v.Mc(1,"Character"),v.Wb())}function T(t,e){if(1&t&&(v.Xb(0,"mat-cell"),v.Mc(1),v.Wb()),2&t){var a=e.$implicit;v.Eb(1),v.Oc(" ",null!=a.pivot&&a.pivot.character?a.pivot.character:"-"," ")}}function G(t,e){1&t&&(v.Xb(0,"mat-header-cell",52),v.Mc(1,"Department"),v.Wb())}function Q(t,e){if(1&t&&(v.Xb(0,"mat-cell"),v.Mc(1),v.Wb()),2&t){var a=e.$implicit;v.Eb(1),v.Oc(" ",null!=a.pivot&&a.pivot.department?a.pivot.department:"-"," ")}}function B(t,e){1&t&&(v.Xb(0,"mat-header-cell",52),v.Mc(1,"Job"),v.Wb())}function H(t,e){if(1&t&&(v.Xb(0,"mat-cell"),v.Mc(1),v.Wb()),2&t){var a=e.$implicit;v.Eb(1),v.Oc(" ",null!=a.pivot&&a.pivot.job?a.pivot.job:"-"," ")}}function J(t,e){1&t&&v.Sb(0,"mat-header-cell")}function L(t,e){if(1&t){var a=v.Yb();v.Xb(0,"mat-cell"),v.Xb(1,"button",54),v.ec("click",(function(){v.Bc(a);var t=e.$implicit;return v.ic().detachCredit(t)})),v.Sb(2,"mat-icon",55),v.Wb(),v.Wb()}}function Y(t,e){1&t&&v.Sb(0,"mat-header-row")}function Z(t,e){1&t&&v.Sb(0,"mat-row")}function tt(t,e){1&t&&(v.Xb(0,"no-results-message"),v.Xb(1,"span",56),v.Mc(2,"Nothing to Display."),v.Wb(),v.Xb(3,"span",57),v.Mc(4,"There are no credits attached yet."),v.Wb(),v.Wb())}var et,at,rt,nt=function(){return["credit","character","department","job","edit"]},ot=[{path:"",component:(et=function(){function t(e,a,r,o,i,c){n(this,t),this.store=e,this.toast=a,this.router=r,this.fb=o,this.route=i,this.uploadQueue=c,this.poster$=new W.a(null),this.dataSource=new w.p,this.personForm=this.fb.group({name:[""],poster:[""],popularity:[""],description:[""],known_for:[""],birth_place:[""],birth_date:[""],death_date:[""],gender:[null],allow_update:[!0]})}return r(t,[{key:"ngOnInit",value:function(){var t=this;this.dataSource.sortingDataAccessor=function(t,e){switch(e){case"credit":return t.name;default:return t.pivot[e]}},this.route.params.subscribe((function(e){t.loadPerson(e)})),this.store.select(X.credits).subscribe((function(e){t.dataSource.data=e})),this.personForm.get("poster").valueChanges.subscribe((function(e){t.poster$.next(e)}))}},{key:"ngOnDestroy",value:function(){this.store.dispatch(new f)}},{key:"uploadPoster",value:function(){var t=this;Object(O.a)({types:[k.a.image]}).then((function(e){t.uploadQueue.start(e,{uri:"uploads/images",httpParams:{diskPrefix:"media-images/posters"}}).subscribe((function(e){t.personForm.patchValue({poster:e.fileEntry.url})}))}))}},{key:"loadPerson",value:function(t){var e=this;t.id&&this.store.dispatch(new u(+t.id)).subscribe((function(){var t=e.store.selectSnapshot(X.person);e.personForm.patchValue(t),e.poster$.next(t.poster)}))}},{key:"submit",value:function(){var t=this,e=this.store.selectSnapshot(X.person);this.store.dispatch(e.id?new m(this.personForm.value):new d(this.personForm.value)).subscribe((function(){t.router.navigate(e.id?[t.router.url.includes("admin")?"admin/people":t.router.url.split("?")[0].replace("/edit","")]:["edit"]),t.toast.open(e.id?C.a.PERSON_UPDATE_SUCCESS:C.a.PERSON_CREATE_SUCCESS)}))}},{key:"detachCredit",value:function(t){var e=this;t.pivot&&this.store.dispatch(new b(t.pivot.id)).subscribe((function(){e.toast.open(C.a.CREDIT_REMOVE_SUCCESS)}))}},{key:"applyFilter",value:function(t){this.dataSource.filter=t}}]),t}(),et.\u0275fac=function(t){return new(t||et)(v.Rb(s.g),v.Rb(E.b),v.Rb(p.d),v.Rb(M.h),v.Rb(p.a),v.Rb(j.a))},et.\u0275cmp=v.Lb({type:et,selectors:[["crupdate-person-page"]],features:[v.Db([j.a])],decls:95,vars:25,consts:[["animationDuration","0ms","color","accent",1,"material-panel"],[3,"label"],["ngNativeValidate","",1,"primary-facts-panel",3,"formGroup","ngSubmit"],[1,"left-col"],["size","medium",3,"src"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button"],[1,"right-col","many-inputs"],[1,"inline-container","many-inputs"],[1,"input-container"],["for","name","trans",""],["type","text","formControlName","name","id","name","required",""],["for","known_for","trans",""],["type","text","formControlName","known_for","id","known_for"],["for","poster","trans",""],[1,"input-with-action","action-left"],["type","button","mat-flat-button","","color","accent",3,"matTooltip","click"],["svgIcon","file-upload"],["type","text","formControlName","poster","id","poster","minlength","1","maxlength","250"],["for","description","trans",""],["id","description","formControlName","description","cdkTextareaAutosize","","cdkAutosizeMinRows","10","cdkAutosizeMaxRows","100"],["for","gender","trans",""],["id","gender","formControlName","gender"],[3,"ngValue"],["value","male","trans",""],["value","female","trans",""],["for","birth_date","trans",""],["type","date","id","birth_date","formControlName","birth_date"],["for","death_date","trans",""],["type","date","id","death_date","formControlName","death_date"],["for","popularity","trans",""],["type","number","formControlName","popularity","id","popularity","min","1","max","1000","step","0.1"],["for","birth_place","trans",""],["type","text","id","birth_place","formControlName","birth_place"],["for","allow_update","trans",""],["formControlName","allow_update","id","allow_update","required",""],["trans","",3,"ngValue"],[1,"table-header"],["type","text","placeholder","Search...","trans-placeholder","",3,"keyup"],["svgIcon","search"],["matSort","",1,"credits-table",3,"dataSource"],["matColumnDef","credit"],["mat-sort-header","","trans","",4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","character"],["matColumnDef","department"],["matColumnDef","job"],["matColumnDef","edit"],[4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[4,"ngIf"],[1,"overlay",3,"isVisible"],["mat-sort-header","","trans",""],["size","small",3,"src"],["type","button","mat-icon-button","",3,"click"],["svgIcon","close"],["primary-text","","trans",""],["secondary-text","","trans",""]],template:function(t,e){1&t&&(v.Xb(0,"mat-tab-group",0),v.Xb(1,"mat-tab",1),v.jc(2,"trans"),v.Xb(3,"form",2),v.ec("ngSubmit",(function(){return e.submit()})),v.Xb(4,"div",3),v.Sb(5,"media-image",4),v.jc(6,"async"),v.Xb(7,"button",5),v.Mc(8,"Save"),v.Wb(),v.Wb(),v.Xb(9,"div",6),v.Xb(10,"div",7),v.Xb(11,"div",8),v.Xb(12,"label",9),v.Mc(13,"Name"),v.Wb(),v.Sb(14,"input",10),v.Wb(),v.Xb(15,"div",8),v.Xb(16,"label",11),v.Mc(17,"Known For"),v.Wb(),v.Sb(18,"input",12),v.Wb(),v.Wb(),v.Xb(19,"div",8),v.Xb(20,"label",13),v.Mc(21,"Image"),v.Wb(),v.Xb(22,"div",14),v.Xb(23,"button",15),v.ec("click",(function(){return e.uploadPoster()})),v.jc(24,"trans"),v.Sb(25,"mat-icon",16),v.Wb(),v.Sb(26,"input",17),v.Wb(),v.Wb(),v.Xb(27,"div",8),v.Xb(28,"label",18),v.Mc(29,"Biography"),v.Wb(),v.Sb(30,"textarea",19),v.Wb(),v.Xb(31,"div",7),v.Xb(32,"div",8),v.Xb(33,"label",20),v.Mc(34,"Gender"),v.Wb(),v.Xb(35,"select",21),v.Xb(36,"option",22),v.Mc(37,"-"),v.Wb(),v.Xb(38,"option",23),v.Mc(39,"Male"),v.Wb(),v.Xb(40,"option",24),v.Mc(41,"Female"),v.Wb(),v.Wb(),v.Wb(),v.Xb(42,"div",8),v.Xb(43,"label",25),v.Mc(44,"Birth Date"),v.Wb(),v.Sb(45,"input",26),v.Wb(),v.Xb(46,"div",8),v.Xb(47,"label",27),v.Mc(48,"Death Date"),v.Wb(),v.Sb(49,"input",28),v.Wb(),v.Wb(),v.Xb(50,"div",7),v.Xb(51,"div",8),v.Xb(52,"label",29),v.Mc(53,"Popularity"),v.Wb(),v.Sb(54,"input",30),v.Wb(),v.Xb(55,"div",8),v.Xb(56,"label",31),v.Mc(57,"Birth Place"),v.Wb(),v.Sb(58,"input",32),v.Wb(),v.Xb(59,"div",8),v.Xb(60,"label",33),v.Mc(61,"Allow Auto Update"),v.Wb(),v.Xb(62,"select",34),v.Xb(63,"option",35),v.Mc(64,"Yes"),v.Wb(),v.Xb(65,"option",35),v.Mc(66,"No"),v.Wb(),v.Wb(),v.Wb(),v.Wb(),v.Wb(),v.Wb(),v.Wb(),v.Xb(67,"mat-tab",1),v.jc(68,"trans"),v.Xb(69,"div",36),v.Xb(70,"div",8),v.Xb(71,"input",37),v.ec("keyup",(function(t){return e.applyFilter(t.target.value)})),v.Wb(),v.Sb(72,"mat-icon",38),v.Wb(),v.Wb(),v.Xb(73,"mat-table",39),v.Vb(74,40),v.Kc(75,I,2,0,"mat-header-cell",41),v.Kc(76,$,4,2,"mat-cell",42),v.Ub(),v.Vb(77,43),v.Kc(78,z,2,0,"mat-header-cell",41),v.Kc(79,T,2,1,"mat-cell",42),v.Ub(),v.Vb(80),v.Vb(81,44),v.Kc(82,G,2,0,"mat-header-cell",41),v.Kc(83,Q,2,1,"mat-cell",42),v.Ub(),v.Vb(84,45),v.Kc(85,B,2,0,"mat-header-cell",41),v.Kc(86,H,2,1,"mat-cell",42),v.Ub(),v.Ub(),v.Vb(87,46),v.Kc(88,J,1,0,"mat-header-cell",47),v.Kc(89,L,3,0,"mat-cell",42),v.Ub(),v.Kc(90,Y,1,0,"mat-header-row",48),v.Kc(91,Z,1,0,"mat-row",49),v.Wb(),v.Kc(92,tt,5,0,"no-results-message",50),v.Wb(),v.Wb(),v.Sb(93,"loading-indicator",51),v.jc(94,"async")),2&t&&(v.Eb(1),v.qc("label",v.kc(2,13,"Primary Facts")),v.Eb(2),v.qc("formGroup",e.personForm),v.Eb(2),v.qc("src",v.kc(6,15,e.poster$)),v.Eb(18),v.qc("matTooltip",v.kc(24,17,"Upload poster")),v.Eb(13),v.qc("ngValue",null),v.Eb(27),v.qc("ngValue",!0),v.Eb(2),v.qc("ngValue",!1),v.Eb(2),v.qc("label",v.kc(68,19,"Credits")),v.Eb(6),v.qc("dataSource",e.dataSource),v.Eb(17),v.qc("matHeaderRowDef",v.tc(23,nt)),v.Eb(1),v.qc("matRowDefColumns",v.tc(24,nt)),v.Eb(1),v.qc("ngIf",!e.dataSource.data.length),v.Eb(1),v.qc("isVisible",v.kc(94,21,e.loading$)))},directives:[P.c,P.a,M.v,M.m,D.a,_.b,N.a,M.d,M.u,M.k,M.F,R.a,q.a,M.q,M.p,V.b,M.G,M.z,M.J,M.A,w.o,F.a,w.c,w.i,w.b,w.k,w.n,c.t,A.a,w.h,F.b,w.a,w.j,w.m,K.a],pipes:[U.a,c.b],styles:["crupdate-person-page{display:block;width:100%;padding:25px}crupdate-person-page .inline-container{display:flex}crupdate-person-page .inline-container .input-container{flex:1 1 auto}crupdate-person-page .inline-container .input-container:not(:last-of-type){margin-right:15px}crupdate-person-page .inline-container .input-container.size-small{flex:1 1 30%}crupdate-person-page .mat-tab-group{margin-bottom:25px}crupdate-person-page .mat-tab-body-wrapper{padding:20px 0}crupdate-person-page .mat-tab-label-content{text-transform:capitalize}crupdate-person-page .primary-facts-panel{display:flex}crupdate-person-page .primary-facts-panel .left-col{flex:0 0 200px;width:200px;margin-right:25px}crupdate-person-page .primary-facts-panel .right-col{flex:1 1 auto}crupdate-person-page .primary-facts-panel media-image img{max-width:100%;box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12);border-radius:4px}crupdate-person-page .primary-facts-panel .submit-button{width:100%;margin-top:15px;min-height:45px}crupdate-person-page .credits-table{padding:0 10px}crupdate-person-page .mat-column-credit media-image{margin-right:10px}crupdate-person-page .mat-column-credit media-image img{width:30px;height:40px;-o-object-fit:cover;object-fit:cover}crupdate-person-page .mat-column-edit{color:var(--be-secondary-text);max-width:100px}crupdate-person-page .mat-column-department,crupdate-person-page .mat-column-job{text-transform:capitalize}crupdate-person-page .table-header{display:flex;align-items:center;margin-bottom:10px;padding:1px 15px}crupdate-person-page .table-header .input-container{max-width:400px;position:relative}crupdate-person-page .table-header .input-container .mat-icon{position:absolute;top:11px;right:8px}crupdate-person-page no-results-message{margin:50px 0 40px}"],encapsulation:2,changeDetection:0}),Object(l.b)([Object(s.d)(X.loading)],et.prototype,"loading$",void 0),Object(l.b)([Object(s.d)(X.credits)],et.prototype,"credits$",void 0),et),data:{permissions:["people.update"]}}],it=((at=function t(){n(this,t)}).\u0275mod=v.Pb({type:at}),at.\u0275inj=v.Ob({factory:function(t){return new(t||at)},imports:[[p.h.forChild(ot)],p.h]}),at),ct=o("6rvT"),pt=o("ZFTr"),lt=o("Iysn"),st=o("X3pI"),ut=((rt=function t(){n(this,t)}).\u0275mod=v.Pb({type:rt}),rt.\u0275inj=v.Ob({factory:function(t){return new(t||rt)},imports:[[c.c,it,ct.a,M.o,M.E,pt.a,lt.a,st.a,s.c.forFeature([X]),P.g,_.c,q.b,R.b,V.c,w.q,F.c]]}),rt)}}])}();
//# sourceMappingURL=2-es5.0cdcae39c4f386d46293.js.map