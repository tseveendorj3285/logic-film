(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{WMcg:function(t,e,a){"use strict";a.r(e),a.d(e,"CrupdatePersonModule",(function(){return ot}));var r=a("ofXK"),o=a("tyNb"),n=a("mrSG"),i=a("AcyG");let c=(()=>{class t{constructor(t){this.id=t}}return t.type="[CrupdatePerson] Load Person",t})(),p=(()=>{class t{constructor(t){this.id=t}}return t.type="[CrupdatePerson] Detach Credit",t})(),s=(()=>{class t{constructor(t){this.payload=t}}return t.type="[CrupdatePerson] Create Person",t})(),l=(()=>{class t{constructor(t){this.payload=t}}return t.type="[CrupdatePerson] Update Person",t})(),b=(()=>{class t{}return t.type="[CrupdatePerson] Reset State",t})();class d{constructor(t={}){for(const e in t)this[e]=t[e]}}var u=a("vkgz"),m=a("nYR2"),h=a("fXoL"),f=a("ZQmV"),g=a("7tLl");let y=(()=>{let t=class{constructor(t,e){this.people=t,this.titles=e}static person(t){return t.person}static loading(t){return t.loading}static credits(t){return t.credits}loadPerson(t,e){return t.patchState({loading:!0}),this.people.get(e.id).pipe(Object(u.a)(e=>{t.patchState({person:e.person,credits:this.flattenCredits(e.credits),loading:!1})}))}createPerson(t,e){return t.patchState({loading:!0}),this.people.create(e.payload).pipe(Object(m.a)(()=>t.patchState({loading:!1})),Object(u.a)(e=>t.patchState({person:e.person})))}updatePerson(t,e){return t.patchState({loading:!0}),this.people.update(t.getState().person.id,e.payload).pipe(Object(m.a)(()=>t.patchState({loading:!1})),Object(u.a)(e=>t.patchState({person:e.person})))}removeCredit(t,e){return t.patchState({loading:!0}),this.titles.removeCredit(e.id).pipe(Object(u.a)(()=>{const a=t.getState().credits.filter(t=>t.pivot.id!==e.id);t.patchState({credits:a})}),Object(m.a)(()=>t.patchState({loading:!1})))}resetState(t){t.patchState({person:new d,credits:[],loading:!1})}flattenCredits(t){const e=[];return Object.keys(t).forEach(a=>{e.push(...t[a])}),e}};return t.\u0275fac=function(e){return new(e||t)(h.bc(f.a),h.bc(g.a))},t.\u0275prov=h.Nb({token:t,factory:t.\u0275fac}),Object(n.b)([Object(i.a)(c)],t.prototype,"loadPerson",null),Object(n.b)([Object(i.a)(s)],t.prototype,"createPerson",null),Object(n.b)([Object(i.a)(l)],t.prototype,"updatePerson",null),Object(n.b)([Object(i.a)(p)],t.prototype,"removeCredit",null),Object(n.b)([Object(i.a)(b)],t.prototype,"resetState",null),Object(n.b)([Object(i.e)()],t,"person",null),Object(n.b)([Object(i.e)()],t,"loading",null),Object(n.b)([Object(i.e)()],t,"credits",null),t=Object(n.b)([Object(i.f)({name:"crupdatePerson",defaults:{person:new d,credits:[],loading:!1}})],t),t})();var v=a("2Vo4"),S=a("+0xr"),x=a("r2Ys"),X=a("h586"),W=a("Lm4C"),w=a("QeDF"),C=a("i2dy"),j=a("3Pt+"),O=a("wZkO"),E=a("l9qf"),M=a("bTqV"),P=a("Rd8u"),D=a("Qu3c"),k=a("NFeN"),_=a("ihCf"),N=a("Dh3D"),R=a("FBzJ"),q=a("CH4Q"),V=a("zW5C");function F(t,e){1&t&&(h.Xb(0,"mat-header-cell",52),h.Mc(1,"Credit"),h.Wb())}function K(t,e){if(1&t&&(h.Xb(0,"mat-cell"),h.Sb(1,"media-image",53),h.Xb(2,"span"),h.Mc(3),h.Wb(),h.Wb()),2&t){const t=e.$implicit;h.Eb(1),h.qc("src",t.poster),h.Eb(2),h.Nc(t.name)}}function U(t,e){1&t&&(h.Xb(0,"mat-header-cell",52),h.Mc(1,"Character"),h.Wb())}function z(t,e){if(1&t&&(h.Xb(0,"mat-cell"),h.Mc(1),h.Wb()),2&t){const t=e.$implicit;h.Eb(1),h.Oc(" ",null!=t.pivot&&t.pivot.character?t.pivot.character:"-"," ")}}function $(t,e){1&t&&(h.Xb(0,"mat-header-cell",52),h.Mc(1,"Department"),h.Wb())}function A(t,e){if(1&t&&(h.Xb(0,"mat-cell"),h.Mc(1),h.Wb()),2&t){const t=e.$implicit;h.Eb(1),h.Oc(" ",null!=t.pivot&&t.pivot.department?t.pivot.department:"-"," ")}}function I(t,e){1&t&&(h.Xb(0,"mat-header-cell",52),h.Mc(1,"Job"),h.Wb())}function T(t,e){if(1&t&&(h.Xb(0,"mat-cell"),h.Mc(1),h.Wb()),2&t){const t=e.$implicit;h.Eb(1),h.Oc(" ",null!=t.pivot&&t.pivot.job?t.pivot.job:"-"," ")}}function G(t,e){1&t&&h.Sb(0,"mat-header-cell")}function Q(t,e){if(1&t){const t=h.Yb();h.Xb(0,"mat-cell"),h.Xb(1,"button",54),h.ec("click",(function(){h.Bc(t);const a=e.$implicit;return h.ic().detachCredit(a)})),h.Sb(2,"mat-icon",55),h.Wb(),h.Wb()}}function B(t,e){1&t&&h.Sb(0,"mat-header-row")}function H(t,e){1&t&&h.Sb(0,"mat-row")}function J(t,e){1&t&&(h.Xb(0,"no-results-message"),h.Xb(1,"span",56),h.Mc(2,"Nothing to Display."),h.Wb(),h.Xb(3,"span",57),h.Mc(4,"There are no credits attached yet."),h.Wb(),h.Wb())}const L=function(){return["credit","character","department","job","edit"]},Y=[{path:"",component:(()=>{class t{constructor(t,e,a,r,o,n){this.store=t,this.toast=e,this.router=a,this.fb=r,this.route=o,this.uploadQueue=n,this.poster$=new v.a(null),this.dataSource=new S.p,this.personForm=this.fb.group({name:[""],poster:[""],popularity:[""],description:[""],known_for:[""],birth_place:[""],birth_date:[""],death_date:[""],gender:[null],allow_update:[!0]})}ngOnInit(){this.dataSource.sortingDataAccessor=(t,e)=>{switch(e){case"credit":return t.name;default:return t.pivot[e]}},this.route.params.subscribe(t=>{this.loadPerson(t)}),this.store.select(y.credits).subscribe(t=>{this.dataSource.data=t}),this.personForm.get("poster").valueChanges.subscribe(t=>{this.poster$.next(t)})}ngOnDestroy(){this.store.dispatch(new b)}uploadPoster(){Object(W.a)({types:[w.a.image]}).then(t=>{this.uploadQueue.start(t,{uri:"uploads/images",httpParams:{diskPrefix:"media-images/posters"}}).subscribe(t=>{this.personForm.patchValue({poster:t.fileEntry.url})})})}loadPerson(t){t.id&&this.store.dispatch(new c(+t.id)).subscribe(()=>{const t=this.store.selectSnapshot(y.person);this.personForm.patchValue(t),this.poster$.next(t.poster)})}submit(){const t=this.store.selectSnapshot(y.person);this.store.dispatch(t.id?new l(this.personForm.value):new s(this.personForm.value)).subscribe(()=>{this.router.navigate(t.id?[this.router.url.includes("admin")?"admin/people":this.router.url.split("?")[0].replace("/edit","")]:["edit"]),this.toast.open(t.id?x.a.PERSON_UPDATE_SUCCESS:x.a.PERSON_CREATE_SUCCESS)})}detachCredit(t){t.pivot&&this.store.dispatch(new p(t.pivot.id)).subscribe(()=>{this.toast.open(x.a.CREDIT_REMOVE_SUCCESS)})}applyFilter(t){this.dataSource.filter=t}}return t.\u0275fac=function(e){return new(e||t)(h.Rb(i.g),h.Rb(C.b),h.Rb(o.d),h.Rb(j.h),h.Rb(o.a),h.Rb(X.a))},t.\u0275cmp=h.Lb({type:t,selectors:[["crupdate-person-page"]],features:[h.Db([X.a])],decls:95,vars:25,consts:[["animationDuration","0ms","color","accent",1,"material-panel"],[3,"label"],["ngNativeValidate","",1,"primary-facts-panel",3,"formGroup","ngSubmit"],[1,"left-col"],["size","medium",3,"src"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button"],[1,"right-col","many-inputs"],[1,"inline-container","many-inputs"],[1,"input-container"],["for","name","trans",""],["type","text","formControlName","name","id","name","required",""],["for","known_for","trans",""],["type","text","formControlName","known_for","id","known_for"],["for","poster","trans",""],[1,"input-with-action","action-left"],["type","button","mat-flat-button","","color","accent",3,"matTooltip","click"],["svgIcon","file-upload"],["type","text","formControlName","poster","id","poster","minlength","1","maxlength","250"],["for","description","trans",""],["id","description","formControlName","description","cdkTextareaAutosize","","cdkAutosizeMinRows","10","cdkAutosizeMaxRows","100"],["for","gender","trans",""],["id","gender","formControlName","gender"],[3,"ngValue"],["value","male","trans",""],["value","female","trans",""],["for","birth_date","trans",""],["type","date","id","birth_date","formControlName","birth_date"],["for","death_date","trans",""],["type","date","id","death_date","formControlName","death_date"],["for","popularity","trans",""],["type","number","formControlName","popularity","id","popularity","min","1","max","1000","step","0.1"],["for","birth_place","trans",""],["type","text","id","birth_place","formControlName","birth_place"],["for","allow_update","trans",""],["formControlName","allow_update","id","allow_update","required",""],["trans","",3,"ngValue"],[1,"table-header"],["type","text","placeholder","Search...","trans-placeholder","",3,"keyup"],["svgIcon","search"],["matSort","",1,"credits-table",3,"dataSource"],["matColumnDef","credit"],["mat-sort-header","","trans","",4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","character"],["matColumnDef","department"],["matColumnDef","job"],["matColumnDef","edit"],[4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[4,"ngIf"],[1,"overlay",3,"isVisible"],["mat-sort-header","","trans",""],["size","small",3,"src"],["type","button","mat-icon-button","",3,"click"],["svgIcon","close"],["primary-text","","trans",""],["secondary-text","","trans",""]],template:function(t,e){1&t&&(h.Xb(0,"mat-tab-group",0),h.Xb(1,"mat-tab",1),h.jc(2,"trans"),h.Xb(3,"form",2),h.ec("ngSubmit",(function(){return e.submit()})),h.Xb(4,"div",3),h.Sb(5,"media-image",4),h.jc(6,"async"),h.Xb(7,"button",5),h.Mc(8,"Save"),h.Wb(),h.Wb(),h.Xb(9,"div",6),h.Xb(10,"div",7),h.Xb(11,"div",8),h.Xb(12,"label",9),h.Mc(13,"Name"),h.Wb(),h.Sb(14,"input",10),h.Wb(),h.Xb(15,"div",8),h.Xb(16,"label",11),h.Mc(17,"Known For"),h.Wb(),h.Sb(18,"input",12),h.Wb(),h.Wb(),h.Xb(19,"div",8),h.Xb(20,"label",13),h.Mc(21,"Image"),h.Wb(),h.Xb(22,"div",14),h.Xb(23,"button",15),h.ec("click",(function(){return e.uploadPoster()})),h.jc(24,"trans"),h.Sb(25,"mat-icon",16),h.Wb(),h.Sb(26,"input",17),h.Wb(),h.Wb(),h.Xb(27,"div",8),h.Xb(28,"label",18),h.Mc(29,"Biography"),h.Wb(),h.Sb(30,"textarea",19),h.Wb(),h.Xb(31,"div",7),h.Xb(32,"div",8),h.Xb(33,"label",20),h.Mc(34,"Gender"),h.Wb(),h.Xb(35,"select",21),h.Xb(36,"option",22),h.Mc(37,"-"),h.Wb(),h.Xb(38,"option",23),h.Mc(39,"Male"),h.Wb(),h.Xb(40,"option",24),h.Mc(41,"Female"),h.Wb(),h.Wb(),h.Wb(),h.Xb(42,"div",8),h.Xb(43,"label",25),h.Mc(44,"Birth Date"),h.Wb(),h.Sb(45,"input",26),h.Wb(),h.Xb(46,"div",8),h.Xb(47,"label",27),h.Mc(48,"Death Date"),h.Wb(),h.Sb(49,"input",28),h.Wb(),h.Wb(),h.Xb(50,"div",7),h.Xb(51,"div",8),h.Xb(52,"label",29),h.Mc(53,"Popularity"),h.Wb(),h.Sb(54,"input",30),h.Wb(),h.Xb(55,"div",8),h.Xb(56,"label",31),h.Mc(57,"Birth Place"),h.Wb(),h.Sb(58,"input",32),h.Wb(),h.Xb(59,"div",8),h.Xb(60,"label",33),h.Mc(61,"Allow Auto Update"),h.Wb(),h.Xb(62,"select",34),h.Xb(63,"option",35),h.Mc(64,"Yes"),h.Wb(),h.Xb(65,"option",35),h.Mc(66,"No"),h.Wb(),h.Wb(),h.Wb(),h.Wb(),h.Wb(),h.Wb(),h.Wb(),h.Xb(67,"mat-tab",1),h.jc(68,"trans"),h.Xb(69,"div",36),h.Xb(70,"div",8),h.Xb(71,"input",37),h.ec("keyup",(function(t){return e.applyFilter(t.target.value)})),h.Wb(),h.Sb(72,"mat-icon",38),h.Wb(),h.Wb(),h.Xb(73,"mat-table",39),h.Vb(74,40),h.Kc(75,F,2,0,"mat-header-cell",41),h.Kc(76,K,4,2,"mat-cell",42),h.Ub(),h.Vb(77,43),h.Kc(78,U,2,0,"mat-header-cell",41),h.Kc(79,z,2,1,"mat-cell",42),h.Ub(),h.Vb(80),h.Vb(81,44),h.Kc(82,$,2,0,"mat-header-cell",41),h.Kc(83,A,2,1,"mat-cell",42),h.Ub(),h.Vb(84,45),h.Kc(85,I,2,0,"mat-header-cell",41),h.Kc(86,T,2,1,"mat-cell",42),h.Ub(),h.Ub(),h.Vb(87,46),h.Kc(88,G,1,0,"mat-header-cell",47),h.Kc(89,Q,3,0,"mat-cell",42),h.Ub(),h.Kc(90,B,1,0,"mat-header-row",48),h.Kc(91,H,1,0,"mat-row",49),h.Wb(),h.Kc(92,J,5,0,"no-results-message",50),h.Wb(),h.Wb(),h.Sb(93,"loading-indicator",51),h.jc(94,"async")),2&t&&(h.Eb(1),h.qc("label",h.kc(2,13,"Primary Facts")),h.Eb(2),h.qc("formGroup",e.personForm),h.Eb(2),h.qc("src",h.kc(6,15,e.poster$)),h.Eb(18),h.qc("matTooltip",h.kc(24,17,"Upload poster")),h.Eb(13),h.qc("ngValue",null),h.Eb(27),h.qc("ngValue",!0),h.Eb(2),h.qc("ngValue",!1),h.Eb(2),h.qc("label",h.kc(68,19,"Credits")),h.Eb(6),h.qc("dataSource",e.dataSource),h.Eb(17),h.qc("matHeaderRowDef",h.tc(23,L)),h.Eb(1),h.qc("matRowDefColumns",h.tc(24,L)),h.Eb(1),h.qc("ngIf",!e.dataSource.data.length),h.Eb(1),h.qc("isVisible",h.kc(94,21,e.loading$)))},directives:[O.c,O.a,j.v,j.m,E.a,M.b,P.a,j.d,j.u,j.k,j.F,D.a,k.a,j.q,j.p,_.b,j.G,j.z,j.J,j.A,S.o,N.a,S.c,S.i,S.b,S.k,S.n,r.t,R.a,S.h,N.b,S.a,S.j,S.m,q.a],pipes:[V.a,r.b],styles:["crupdate-person-page{display:block;width:100%;padding:25px}crupdate-person-page .inline-container{display:flex}crupdate-person-page .inline-container .input-container{flex:1 1 auto}crupdate-person-page .inline-container .input-container:not(:last-of-type){margin-right:15px}crupdate-person-page .inline-container .input-container.size-small{flex:1 1 30%}crupdate-person-page .mat-tab-group{margin-bottom:25px}crupdate-person-page .mat-tab-body-wrapper{padding:20px 0}crupdate-person-page .mat-tab-label-content{text-transform:capitalize}crupdate-person-page .primary-facts-panel{display:flex}crupdate-person-page .primary-facts-panel .left-col{flex:0 0 200px;width:200px;margin-right:25px}crupdate-person-page .primary-facts-panel .right-col{flex:1 1 auto}crupdate-person-page .primary-facts-panel media-image img{max-width:100%;box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12);border-radius:4px}crupdate-person-page .primary-facts-panel .submit-button{width:100%;margin-top:15px;min-height:45px}crupdate-person-page .credits-table{padding:0 10px}crupdate-person-page .mat-column-credit media-image{margin-right:10px}crupdate-person-page .mat-column-credit media-image img{width:30px;height:40px;-o-object-fit:cover;object-fit:cover}crupdate-person-page .mat-column-edit{color:var(--be-secondary-text);max-width:100px}crupdate-person-page .mat-column-department,crupdate-person-page .mat-column-job{text-transform:capitalize}crupdate-person-page .table-header{display:flex;align-items:center;margin-bottom:10px;padding:1px 15px}crupdate-person-page .table-header .input-container{max-width:400px;position:relative}crupdate-person-page .table-header .input-container .mat-icon{position:absolute;top:11px;right:8px}crupdate-person-page no-results-message{margin:50px 0 40px}"],encapsulation:2,changeDetection:0}),Object(n.b)([Object(i.d)(y.loading)],t.prototype,"loading$",void 0),Object(n.b)([Object(i.d)(y.credits)],t.prototype,"credits$",void 0),t})(),data:{permissions:["people.update"]}}];let Z=(()=>{class t{}return t.\u0275mod=h.Pb({type:t}),t.\u0275inj=h.Ob({factory:function(e){return new(e||t)},imports:[[o.h.forChild(Y)],o.h]}),t})();var tt=a("6rvT"),et=a("ZFTr"),at=a("Iysn"),rt=a("X3pI");let ot=(()=>{class t{}return t.\u0275mod=h.Pb({type:t}),t.\u0275inj=h.Ob({factory:function(e){return new(e||t)},imports:[[r.c,Z,tt.a,j.o,j.E,et.a,at.a,rt.a,i.c.forFeature([y]),O.g,M.c,k.b,D.b,_.c,S.q,N.c]]}),t})()}}]);
//# sourceMappingURL=2-es2015.0cdcae39c4f386d46293.js.map